<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.8: http://docutils.sourceforge.net/" />
<title>Frequently Asked Questions (FAQ)</title>
<link rel="stylesheet" href="./s2e.css" type="text/css" />
</head>
<body>
<div class="document" id="frequently-asked-questions-faq">
<h1 class="title">Frequently Asked Questions (FAQ)</h1>

<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="auto-toc simple">
<li><a class="reference internal" href="#s2e" id="id1">1&nbsp;&nbsp;&nbsp;S2E</a><ul class="auto-toc">
<li><a class="reference internal" href="#how-do-i-know-what-s2e-is-doing" id="id2">1.1&nbsp;&nbsp;&nbsp;How do I know what S2E is doing?</a></li>
<li><a class="reference internal" href="#execution-seems-stuck-slow-what-to-do" id="id3">1.2&nbsp;&nbsp;&nbsp;Execution seems stuck/slow. What to do?</a></li>
<li><a class="reference internal" href="#how-do-i-deal-with-state-explosion" id="id4">1.3&nbsp;&nbsp;&nbsp;How do I deal with state explosion?</a></li>
<li><a class="reference internal" href="#how-to-keep-memory-usage-low" id="id5">1.4&nbsp;&nbsp;&nbsp;How to keep memory usage low?</a></li>
<li><a class="reference internal" href="#how-much-time-is-the-constraint-solver-taking-to-solve-constraints" id="id6">1.5&nbsp;&nbsp;&nbsp;How much time is the constraint solver taking to solve constraints?</a></li>
<li><a class="reference internal" href="#what-do-the-various-fields-in-run-stats-mean" id="id7">1.6&nbsp;&nbsp;&nbsp;What do the various fields in <tt class="docutils literal">run.stats</tt> mean?</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="s2e">
<h1>1&nbsp;&nbsp;&nbsp;S2E</h1>
<div class="section" id="how-do-i-know-what-s2e-is-doing">
<h2>1.1&nbsp;&nbsp;&nbsp;How do I know what S2E is doing?</h2>
<ol class="arabic">
<li><p class="first">Enable execution tracing and use the fork profiler to identify the code locations that fork the most.
In your LUA file, enable the <tt class="docutils literal">ExecutionTracer</tt>, <tt class="docutils literal">ModuleTracer</tt> and the <tt class="docutils literal">ModuleExecutionDetector</tt> plugins.
This will allow you to collect all fork locations. Additionally, you can use <tt class="docutils literal">TranslationBlockTracer</tt>  in order to
have a detailed trace for each execution path, which you can view with the <tt class="docutils literal">tbtrace</tt> tool. Finally, <tt class="docutils literal">TranslationBlockTracer</tt>
allows you to use the basic block <a class="reference external" href="Tools/CoverageGenerator.html">coverage</a> tool.</p>
</li>
<li><p class="first">Look at <tt class="docutils literal"><span class="pre">s2e-last/debug.txt</span></tt> and other files.
These files list all the major events occurring during symbolic execution.</p>
<p>S2E outputs &quot;Firing timer event&quot; into <tt class="docutils literal"><span class="pre">s2e-last/debug.txt</span></tt> once per second.
If you do not see this event every second,
it means that QEMU is stuck running plugin code (most likely because of a plugin bug)
or constraint solver code (because of a complex query).
To see which query is causing the problem, look at the query log.</p>
</li>
<li><p class="first"><tt class="docutils literal">run.stats</tt> also contains types statistics. This file is updated every second,
but only when executing symbolic code. See later in this FAQ for a description of its fields.</p>
</li>
</ol>
</div>
<div class="section" id="execution-seems-stuck-slow-what-to-do">
<h2>1.2&nbsp;&nbsp;&nbsp;Execution seems stuck/slow. What to do?</h2>
<p>Several things may be going on in your execution:</p>
<ul class="simple">
<li>Some constraints are hard to solve. Set a timeout in the constraint solver with <tt class="docutils literal"><span class="pre">--use-forked-stp</span></tt> and <tt class="docutils literal"><span class="pre">--max-stp-time=TimeoutInSeconds</span></tt>.
If you do not see the &quot;Firing timer event&quot; message periodically in the <tt class="docutils literal">debug.txt</tt> log file, execution got stuck in the
constraint solver.</li>
<li>If you used <tt class="docutils literal">s2e_disable_all_apic_interrupts</tt>, you probably forgot an <tt class="docutils literal">s2e_enable_all_apic_interrupts</tt> call somewhere in your code.
Use this functionality with care, disabling interrupts can hang your system</li>
<li>You are doing unnecessary system calls with symbolic arguments (e.g. <tt class="docutils literal">printf</tt>).
Use the <tt class="docutils literal">s2e_get_example_*</tt> functions to provide a concrete value to <tt class="docutils literal">printf</tt>  without actually adding path
constraints, to prevent disabling future paths.</li>
<li>Try to reduce the number of symbolic variables</li>
<li>If you use a depth-first search and execution hits a polling loop, rapid forking may occur and execution may never exit the loop.
Moreover, depending on the accumulated constraints, each iteration may be slow.
Try to use a different search strategy or kill the unwanted execution paths.</li>
</ul>
</div>
<div class="section" id="how-do-i-deal-with-state-explosion">
<h2>1.3&nbsp;&nbsp;&nbsp;How do I deal with state explosion?</h2>
<p>Use the <em>selective</em> aspect of S2E to kill states that are not interesting and prevent forking outside modules of interest.
The following describes concrete steps that allowed us to explore programs most efficiently.</p>
<ol class="arabic simple">
<li>Run your program with minimum symbolic input (e.g., 1 byte) and with tracing enabled (see first section).</li>
<li>Insert more and more symbolic values until state explosion occurs (i.e., it takes too long for you to explore all the paths
or it takes too much memory/CPU resources).</li>
<li>Extract the fork profile and identify the code locations that fork the most.</li>
<li>If forking occurs outside the module of interest, a few options are:<ul>
<li>Use the <tt class="docutils literal">CodeSelector</tt> plugin to disable forking when execution leaves the module of interest</li>
<li>Concretize some symbolic values when execution leaves the module of interest. You may need to use the <tt class="docutils literal">FunctionMonitor</tt> plugin
to track function calls and concretize parameters.</li>
<li>Provide example values to the library (e.g., to <tt class="docutils literal">printf</tt>, as described previously)</li>
</ul>
</li>
<li>Prioritize states according to a metric that makes sense for your problem.
This may be done by writing a custom state searcher plugin. S2E comes with several examples of searchers that aim to maximize code coverage
as fast as possible.</li>
</ol>
</div>
<div class="section" id="how-to-keep-memory-usage-low">
<h2>1.4&nbsp;&nbsp;&nbsp;How to keep memory usage low?</h2>
<p>You can use several options, depending on your needs.</p>
<ul class="simple">
<li>Enable the shared framebuffer. By default, each state writes to its own framebuffer, which
may add up to several megabytes to each state. However, it often does not matter what appears on
the screen. In such case, use the <tt class="docutils literal"><span class="pre">--state-shared-memory=true</span></tt> option.</li>
<li>Disable forking when a memory limit is reached
using the following KLEE options: <tt class="docutils literal"><span class="pre">--max-memory-inhibit</span></tt> and  <tt class="docutils literal"><span class="pre">--max-memory=MemoryLimitInMB</span></tt>.</li>
<li>Explicitly kill unneeded states. E.g., if you want to achieve high code coverage and
know that some state is unlikely to cover any new code, kill it.</li>
</ul>
</div>
<div class="section" id="how-much-time-is-the-constraint-solver-taking-to-solve-constraints">
<h2>1.5&nbsp;&nbsp;&nbsp;How much time is the constraint solver taking to solve constraints?</h2>
<p>First, enable logging for constraint solving queries:</p>
<pre class="literal-block">
s2e = {
 kleeArgs = {
 &quot;--use-query-log&quot;, &quot;--use-query-pc-log&quot;,  &quot;--use-stp-query-pc-log&quot;
}
</pre>
<p>With this configuration S2E generates two logs: <tt class="docutils literal"><span class="pre">s2e-last/queries.pc</span></tt> and <tt class="docutils literal"><span class="pre">s2e-last/stp-queries.qlog</span></tt>
Look for &quot;Elapsed time&quot; in the logs.</p>
</div>
<div class="section" id="what-do-the-various-fields-in-run-stats-mean">
<h2>1.6&nbsp;&nbsp;&nbsp;What do the various fields in <tt class="docutils literal">run.stats</tt> mean?</h2>
<p>You can open <tt class="docutils literal">run.stats</tt> in a spreadsheet as a CVS file.
Most of the fields are self-explanatory. Here are the trickiest ones:</p>
<ul class="simple">
<li><tt class="docutils literal">QueryTime</tt> shows how much time KLEE spent in the STP solver.</li>
<li><tt class="docutils literal">CexCacheTime</tt> adds to that time also the time spend while looking
for a solution in a counter-example cache (which is enabled by <tt class="docutils literal"><span class="pre">--use-cex-cache</span></tt> KLEE option).
SolverTime shows how much time KLEE spent in total while solving queries
(this includes all the solver optimizations that could be enabled by various solver-related KLEE options).</li>
<li><tt class="docutils literal">ResolveTime</tt> represents time that KLEE spend resolving symbolic
memory addresses, however in S2E this is not computed correctly yet.</li>
<li><tt class="docutils literal">ForkTime</tt> shows how much time KLEE spend on forking (i.e., duplication of) states,
however in S2E right now this does not take into account the time spent on saving/restoring states of devices.</li>
</ul>
</div>
</div>
</div>
<div class="footer">
<hr class="footer" />
<a class="reference external" href="FAQ.rst">View document source</a>.

</div>
</body>
</html>
