<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
<title>Building the S2E Framework</title>
<link rel="stylesheet" href="s2e.css" type="text/css" />
</head>
<body>
<div class="document" id="building-the-s2e-framework">
<h1 class="title">Building the S2E Framework</h1>

<p>The following steps describe installation in detail. We assume the installation
is performed on Ubuntu 10.10 64bit host system (S2E also works on other 64bit
Linux, Mac and Windows systems).</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#required-packages" id="id1">Required Packages</a></li>
<li><a class="reference internal" href="#building-llvm-2-6-with-llvm-gcc" id="id2">Building LLVM-2.6 With llvm-gcc</a></li>
<li><a class="reference internal" href="#checking-out-s2e" id="id3">Checking out S2E</a></li>
<li><a class="reference internal" href="#building-s2e-version-of-stp" id="id4">Building S2E Version of STP</a></li>
<li><a class="reference internal" href="#building-the-s2e-version-of-klee" id="id5">Building the S2E Version of KLEE</a></li>
<li><a class="reference internal" href="#building-s2e-modified-version-of-qemu" id="id6">Building S2E (Modified Version of QEMU)</a></li>
<li><a class="reference internal" href="#building-s2e-tools" id="id7">Building S2E Tools</a></li>
<li><a class="reference internal" href="#preparing-linux-vm-image" id="id8">Preparing Linux VM Image</a></li>
</ul>
</div>
<div class="section" id="required-packages">
<h1>Required Packages</h1>
<pre class="literal-block">
$ sudo apt-get install build-essential
$ sudo apt-get install subversion
$ sudo apt-get install git
$ sudo apt-get install qemu
$ sudo apt-get install liblua5.1-dev
$ sudo apt-get install libsigc++-2.0-dev
$ sudo apt-get install binutils-dev
$ sudo apt-get build-dep llvm-2.7
$ sudo apt-get build-dep qemu
</pre>
</div>
<div class="section" id="building-llvm-2-6-with-llvm-gcc">
<h1>Building LLVM-2.6 With llvm-gcc</h1>
<p>In order to build S2E you must compile LLVM from sources. LLVM installed from
binary distribution packages will not work.</p>
<pre class="literal-block">
$ S2EDIR=/path/to/s2e
$ cd $S2EDIR

$ # Download and unpack llvm-gcc and llvm-2.6
$ wget http://llvm.org/releases/2.6/llvm-gcc-4.2-2.6-x86_64-linux.tar.gz
$ wget http://llvm.org/releases/2.6/llvm-2.6.tar.gz
$ tar -zxf llvm-gcc-4.2-2.6-x86_64-linux.tar.gz
$ tar -zxf llvm-2.6.tar.gz

$ # Create build directory, configure and build
$ mkdir llvm-build
$ cd llvm-build
$ ../llvm-2.6/configure \
    --prefix=$S2EDIR/opt \
    --with-llvmgccdir=$S2EDIR/llvm-gcc-4.2-2.6-x86_64-linux \
    --enable-optimized
$ make ENABLE_OPTIMIZED=1 -j4 # Compile release build
$ make ENABLE_OPTIMIZED=0 -j4 # Compile debug build (you can compile both at the same time)
</pre>
</div>
<div class="section" id="checking-out-s2e">
<h1>Checking out S2E</h1>
<p>S2E source code can be obtained from the DSLab GIT repository. To access it,
you need to obtain an account on <a class="reference external" href="https://dslabgit.epfl.ch">https://dslabgit.epfl.ch</a> and upload your ssh
public key to it. If you don't have an ssh key yet, you can generate it with
the following command:</p>
<pre class="literal-block">
$ ssh-keygen -t rsa -C you&#64;email
&gt; answer questions: store key to default location, optionally set password for it
</pre>
<p>To upload your key, go to <a class="reference external" href="https://dslabgit.epfl.ch">https://dslabgit.epfl.ch</a> -&gt; dashboard -&gt; Manage SSH
keys -&gt; Add SSH key, then copy content of your ~/.ssh/id_rsa.pub and paste it
into the form, then press save. In a few moments your key will be ready to use.
Then you can checkout S2E with the following commands:</p>
<pre class="literal-block">
$ cd $S2EDIR
$ git clone git&#64;dslabgit.epfl.ch:s2e/s2e.git
</pre>
<p>You can find more information about using git on <a class="reference external" href="http://gitref.org/">http://gitref.org/</a> or on
<a class="reference external" href="http://progit.org/">http://progit.org/</a>.</p>
<p>In order to report bugs, please use <a class="reference external" href="https://dslabredmine.epfl.ch">https://dslabredmine.epfl.ch</a>. If you ever
want to contribute to S2E, please create your own personal clone of S2E on
<a class="reference external" href="https://dslabgit.epfl.ch/s2e/s2e">https://dslabgit.epfl.ch/s2e/s2e</a>, push your changes to it and then send us a
merge request.</p>
</div>
<div class="section" id="building-s2e-version-of-stp">
<h1>Building S2E Version of STP</h1>
<p>STP can only be built inside its source directory. It is recommended to copy
STP source into another directory before building:</p>
<pre class="literal-block">
$ cd $S2EDIR
$ cp -R s2e/stp stp-build
$ cd stp-build
$ bash scripts/configure --with-prefix=$(pwd)
$ make
$ cp src/c_interface/c_interface.h include/stp
</pre>
</div>
<div class="section" id="building-the-s2e-version-of-klee">
<h1>Building the S2E Version of KLEE</h1>
<pre class="literal-block">
$ cd $S2EDIR
$ mkdir klee-build
$ cd klee-build
$ ../s2e/klee/configure \
    --prefix=$S2EDIR/opt \
    --with-llvmsrc=$S2EDIR/llvm-2.6 \
    --with-llvmobj=$S2EDIR/llvm-build \
    --with-stp=$S2EDIR/stp-build \
    --enable-exceptions
$ make ENABLE_OPTIMIZED=1 -j4 # Compile release build
$ make ENABLE_OPTIMIZED=0 -j4 # Compile debug build (you can compile both at the same time)
</pre>
</div>
<div class="section" id="building-s2e-modified-version-of-qemu">
<h1>Building S2E (Modified Version of QEMU)</h1>
<pre class="literal-block">
$ cd $S2EDIR

$ # Configure and build QEMU in release mode
$ mkdir qemu-build-release
$ cd qemu-build-release
$ ../s2e/qemu/configure \
    --prefix=$S2EDIR/opt \
    --with-llvm=$S2EDIR/llvm-build/Release \
    --with-llvmgcc=$S2EDIR/llvm-gcc-4.2-2.6-x86_64-linux/bin/llvm-gcc \
    --with-stp=$S2EDIR/stp-build \
    --with-klee=$S2EDIR/klee-build/Release \
    --target-list=i386-s2e-softmmu,i386-softmmu \
    --enable-llvm \
    --enable-s2e
$ make -j4

$ # Verify that QEMU works in vanilla mode
$ ./i386-softmmu/qemu -m 8 # you should see BIOS booting in the VM
$ # Verify that QEMU works in S2E mode
$ ./i386-s2e-softmmu/qemu -m 8 # you should see BIOS booting in the VM

$ # Configure and build QEMU in debug mode
$ mkdir qemu-build-debug
$ cd qemu-build-debug
$ ../s2e/qemu/configure \
    --prefix=$S2EDIR/opt \
    --with-llvm=$S2EDIR/llvm-build/Debug  \
    --with-llvmgcc=$S2EDIR/llvm-gcc-4.2-2.6-x86_64-linux/bin/llvm-gcc \
    --with-stp=$S2EDIR/stp-build \
    --with-klee=$S2EDIR/klee-build/Debug \
    --target-list=i386-s2e-softmmu,i386-softmmu \
    --enable-llvm \
    --enable-s2e \
    --enable-debug
$ make -j4
</pre>
</div>
<div class="section" id="building-s2e-tools">
<h1>Building S2E Tools</h1>
<pre class="literal-block">
$ cd $S2EDIR
$ mkdir tools-build
$ cd tools-build
$ ../s2e/tools/configure \
    --with-llvmsrc=$S2EDIR/llvm-2.6 \
    --with-llvmobj=$S2EDIR/llvm-build \
    --with-s2esrc=$S2EDIR/s2e/qemu \
    --with-s2eobj=$S2EDIR/qemu-build-release
$ make -j4
</pre>
</div>
<div class="section" id="preparing-linux-vm-image">
<h1>Preparing Linux VM Image</h1>
<p>To run S2E you need a QEMU-compatible virtual machine disk image. S2E can run
any x86 32bit operating system inside the VM. In the following we describe how
to install minimal version of Debian Linux in QEMU:</p>
<pre class="literal-block">
$ cd $S2EDIR

$ # Create an empty disk image
$ qemu-img create -f qcow2 s2e_disk.qcow2 2G

$ # Download debian install CD
$ wget http://cdimage.debian.org/debian-cd/5.0.6/i386/iso-cd/debian-506-i386-businesscard.iso

$ # Run QEMU and install the OS
$ qemu s2e_disk.qcow2 -cdrom debian-506-i386-businesscard.iso
&gt; Follow on-screen instructions to install Debian Linux inside VM
&gt; Select only &quot;Standard System&quot; component to install

$ # When you system is installed and rebooted, run the following command
$ # inside the guest to install C and C++ compilers
guest$ su -c &quot;apt-get install build-essential&quot;
</pre>
</div>
</div>
<div class="footer">
<hr class="footer" />
<a class="reference external" href="BuildingS2E.rst">View document source</a>.

</div>
</body>
</html>
