<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.8: http://docutils.sourceforge.net/" />
<title>Building the S2E Framework</title>
<link rel="stylesheet" href="./s2e.css" type="text/css" />
</head>
<body>
<div class="document" id="building-the-s2e-framework">
<h1 class="title">Building the S2E Framework</h1>

<p>The following steps describe the installation process in detail. We assume the installation
is performed on an Ubuntu 10.10 64-bit host system (S2E also works on 64-bit
Linux, Mac, and Windows systems).</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#required-packages" id="id2">Required Packages</a></li>
<li><a class="reference internal" href="#checking-out-s2e" id="id3">Checking out S2E</a></li>
<li><a class="reference internal" href="#building-s2e" id="id4">Building S2E</a></li>
<li><a class="reference internal" href="#updating-s2e" id="id5">Updating S2E</a></li>
<li><a class="reference internal" href="#rebuilding-s2e-documentation" id="id6">Rebuilding S2E Documentation</a></li>
<li><a class="reference internal" href="#preparing-a-linux-vm-image" id="id7">Preparing a Linux VM Image</a></li>
<li><a class="reference internal" href="#compiling-the-linux-kernel" id="id8">Compiling the Linux kernel</a></li>
</ul>
</div>
<div class="section" id="required-packages">
<h1>Required Packages</h1>
<pre class="literal-block">
$ sudo apt-get install build-essential
$ sudo apt-get install subversion
$ sudo apt-get install git
$ sudo apt-get install qemu
$ sudo apt-get install liblua5.1-dev
$ sudo apt-get install libsigc++-2.0-dev
$ sudo apt-get install binutils-dev
$ sudo apt-get install python-docutils
$ sudo apt-get install python-pygments
$ sudo apt-get install nasm
$ sudo apt-get build-dep llvm-2.7
$ sudo apt-get build-dep qemu
</pre>
</div>
<div class="section" id="checking-out-s2e">
<h1>Checking out S2E</h1>
<p>S2E source code can be obtained from the S2E GIT repository using the
following commands:</p>
<pre class="literal-block">
$ cd $S2EDIR
$ git clone https://dslabgit.epfl.ch/git/s2e/s2e.git
</pre>
<p>Alternatively, you can obtain an account on <a class="reference external" href="https://dslabgit.epfl.ch">https://dslabgit.epfl.ch</a> and
upload your public SSH key to it. If you do not have an SSH key yet,
generate it with the following command:</p>
<pre class="literal-block">
$ ssh-keygen -t rsa -C you&#64;email
&gt; answer questions: store key to default location, optionally set password for it
</pre>
<p>To upload your key, go to <a class="reference external" href="https://dslabgit.epfl.ch">https://dslabgit.epfl.ch</a> -&gt; Dashboard -&gt; Manage SSH
keys -&gt; Add SSH key, then copy the content of your ~/.ssh/id_rsa.pub, paste it
into the form, and then press save. Your key is activated within a few moments.
Then, checkout S2E as follows:</p>
<pre class="literal-block">
$ cd $S2EDIR
$ git clone git&#64;dslabgit.epfl.ch:s2e/s2e.git
</pre>
<p>You can find more information about using git on <a class="reference external" href="http://gitref.org/">http://gitref.org/</a> or on
<a class="reference external" href="http://progit.org/">http://progit.org/</a>.</p>
<p>In order to report bugs, please use <a class="reference external" href="https://dslabredmine.epfl.ch">https://dslabredmine.epfl.ch</a>. If you would like
to contribute to S2E, please create your own personal clone of S2E on
<a class="reference external" href="https://dslabgit.epfl.ch/s2e/s2e">https://dslabgit.epfl.ch/s2e/s2e</a>, push your changes to it and then send us a
merge request.</p>
</div>
<div class="section" id="building-s2e">
<h1>Building S2E</h1>
<p>The recommended method of building S2E is using the S2E Makefile:</p>
<pre class="literal-block">
$ mkdir $S2EDIR/build
$ cd $S2EDIR/build
$ ln -s ../s2e/Makefile .
$ make JOBS=4 # Replace 4 with your number of cores
&gt; Go make some coffee, this will take a lot of time
</pre>
<p>By default, the <tt class="docutils literal">make</tt> command compiles S2E in release mode. The resulting
binary is placed in <tt class="docutils literal"><span class="pre">$S2EDIR/build/qemu-release/i386-s2e-softmmu/qemu</span></tt>.
To compile in Debug mode, use <tt class="docutils literal">make <span class="pre">all-debug</span> JOBS=4</tt>.</p>
<p>You can also build each component of S2E manually, as described in <a class="reference external" href="BuildingS2EManually.html">Building
the S2E Framework Manually</a>.</p>
</div>
<div class="section" id="updating-s2e">
<h1>Updating S2E</h1>
<p>You can use the same make file to recompile S2E either when changing it
yourself or when pulling new versions through <tt class="docutils literal">git</tt>. Note that the makefile
will not automatically reconfigure the packages; for deep changes you might need
to either start from scratch by issuing <tt class="docutils literal">make clean</tt> or to force
the reconfiguration of specific modules by deleting  the corresponding files from
<tt class="docutils literal">stamps</tt> subdirectory.</p>
</div>
<div class="section" id="rebuilding-s2e-documentation">
<h1>Rebuilding S2E Documentation</h1>
<p>The S2E documentation is written in <a class="reference external" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> format. For convenience, we also
keep generated HTML files in the repository. Never change HTML files
manually and always recompile them (by invoking <tt class="docutils literal">make</tt> in the docs folder)
after changing any <tt class="docutils literal">RST</tt> files.</p>
</div>
<div class="section" id="preparing-a-linux-vm-image">
<h1>Preparing a Linux VM Image</h1>
<p>To run S2E, you need a QEMU-compatible virtual machine disk image. S2E can run
any x86 32-bit operating system inside the VM. In the following, we describe how
to install a minimal version of Debian Linux in QEMU:</p>
<pre class="literal-block">
$ cd $S2EDIR

$ # Create an empty disk image
$ qemu-img create -f qcow2 s2e_disk.qcow2 2G

$ # Download debian install CD
$ wget http://cdimage.debian.org/debian-cd/5.0.7/i386/iso-cd/debian-507-i386-businesscard.iso

$ # Run QEMU and install the OS
$ qemu s2e_disk.qcow2 -cdrom debian-507-i386-businesscard.iso
&gt; Follow on-screen instructions to install Debian Linux inside VM
&gt; Select only &quot;Standard System&quot; component to install

$ # When you system is installed and rebooted, run the following command
$ # inside the guest to install C and C++ compilers
guest$ su -c &quot;apt-get install build-essential&quot;
</pre>
</div>
<div class="section" id="compiling-the-linux-kernel">
<h1>Compiling the Linux kernel</h1>
<p>Although S2E can run any kernel, it is often convenient to recompile it to suit particular needs.
E.g., enabling Kprobes, adding debug information, etc.
This sections explains how to do it on a Debian system using a <tt class="docutils literal">chroot</tt> environment.
Using chroot makes it easy to compile a 32-bit kernel package on a 64-bit host.</p>
<pre class="literal-block">
$ # Install the bootstrapping environment
$ sudo apt-get install debootstrap

$ # Create the directory with the chroot environment
$ mkdir ~/debian32

$ # From now on, we need root rights
$ sudo -s

$ # Create the basic chroot environment
$ debootstrap --arch i386 lenny debian32/ http://mirror.switch.ch/ftp/mirror/debian/
$ mount -t proc proc debian32/proc

$ # Activate the chroot
$ chroot ~/debian32

$ # Setup devices
$ cd /dev; /sbin/MAKEDEV generic; cd ..

$ # Install build tools
     $ apt-get install build-essential kernel-package locales

$ # Set the locale to UTF-8, otherwise perl will complain
$ export LANGUAGE=en_US.UTF-8
$ export LANG=en_US.UTF-8
$ export LC_ALL=en_US.UTF-8
$ locale-gen en_US.UTF-8
$ dpkg-reconfigure locales

$ # Download the kernel
$ mkdir /root/kernel &amp;&amp; cd /root/kernel
$ wget http://www.kernel.org/pub/linux/kernel/v2.6/linux-2.6.26.8.tar.bz2
$ tar xjvf linux-2.6.26.8.tar.bz2
$ cd linux-2.6.26.8

$ # Select your options
$ make menuconfig

$ # Compile and generate the packages
$ make-kpkg --append-to-version=-s2e --rootcmd fakeroot --initrd kernel_image kernel_headers
</pre>
<p>The result of the process is two <tt class="docutils literal">*.deb</tt> files that you can upload to your VM image.</p>
</div>
</div>
<div class="footer">
<hr class="footer" />
<a class="reference external" href="BuildingS2E.rst">View document source</a>.

</div>
</body>
</html>
